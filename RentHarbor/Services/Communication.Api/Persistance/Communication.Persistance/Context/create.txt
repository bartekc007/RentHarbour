DO $$
BEGIN
    -- Create RentalRequests table if it doesn't exist
    IF NOT EXISTS (
        SELECT FROM information_schema.tables 
        WHERE table_schema = 'public' 
        AND LOWER(table_name) = 'rentalrequests'
    ) THEN
        CREATE TABLE RentalRequests (
            Id SERIAL PRIMARY KEY,
            PropertyId VARCHAR(255) NOT NULL,  -- MongoDB Property ID
            TenantId VARCHAR(255) NOT NULL,  -- Owner ID
            UserId VARCHAR(255) NOT NULL,  -- User ID
            OwnerAcceptance BOOLEAN NOT NULL DEFAULT FALSE,
            UserAcceptance BOOLEAN NOT NULL DEFAULT FALSE,
            StartDate TIMESTAMP NOT NULL,
            EndDate TIMESTAMP NOT NULL,
            NumberOfPeople INT NOT NULL,
            Pets BOOLEAN NOT NULL,
            MessageToOwner TEXT,
            Status VARCHAR(50) NOT NULL  -- e.g., Pending, Approved, Rejected
        );
    END IF;

    -- Create Rentals table if it doesn't exist
    IF NOT EXISTS (
        SELECT FROM information_schema.tables 
        WHERE table_schema = 'public' 
        AND LOWER(table_name) = 'rentals'
    ) THEN
        CREATE TABLE Rentals (
            Id VARCHAR(255) PRIMARY KEY,  -- Assuming the Id is generated by the application
            PropertyId VARCHAR(255) NOT NULL,  -- MongoDB Property ID
            RentalRequestId VARCHAR(255) NOT NULL,  -- Foreign key to RentalRequests
            RenterId VARCHAR(255) NOT NULL,  -- User ID
            StartDate TIMESTAMP NOT NULL,
            EndDate TIMESTAMP NOT NULL
        );
    END IF;

    -- Create Payments table if it doesn't exist
    IF NOT EXISTS (
        SELECT FROM information_schema.tables 
        WHERE table_schema = 'public' 
        AND LOWER(table_name) = 'payments'
    ) THEN
        CREATE TABLE Payments (
            Id VARCHAR(255) PRIMARY KEY,
            UserId VARCHAR(255) NOT NULL,
            PropertyId VARCHAR(255) NOT NULL,
            PaymentDate TIMESTAMP NOT NULL,
            IsPaid BOOLEAN NOT NULL,
            Amount DECIMAL(10, 2) NOT NULL,
            PaidDate TIMESTAMP
        );
    END IF;
END $$;
